Ext.define("Ext.ux.form.ItemSelector",{extend:"Ext.ux.form.MultiSelect",alias:["widget.itemselectorfield","widget.itemselector"],alternateClassName:["Ext.ux.ItemSelector"],requires:["Ext.button.Button","Ext.ux.form.MultiSelect"],hideNavIcons:false,buttons:["top","up","add","remove","down","bottom"],buttonsText:{top:"Move to Top",up:"Move Up",add:"Add to Selected",remove:"Remove from Selected",down:"Move Down",bottom:"Move to Bottom"},initComponent:function(){var a=this;
a.ddGroup=a.id+"-dd";a.callParent();a.bindStore(a.store);},getScrollMultiselect:function(e){var c=this.toField.getStore().getCount();getParentHeight=Ext.get(e.id).getHeight();getParentWidth=Ext.get(e.id).getWidth();fieldID=Ext.getCmp(e.id).getComponent(0).getComponent(0).id;var a=Ext.getCmp(e.id).getComponent(0).id;
var b=Ext.getCmp(a).getHeight()-28;var d=Ext.getCmp(e.id).getStore().getCount();if(c==0){$("#"+this.toField.id+" .x-boundlist-outer-ct").css({"width":getParentWidth+"px","overflow":"hidden"});}Ext.get(e.id).select(".x-boundlist-outer-ct").setHeight(b);$("#"+fieldID+" .x-boundlist-outer-ct").css({"width":getParentWidth+"px","overflow":"auto"});
$("#"+fieldID+" .x-boundlist-list-ct").css({"height":"auto","overflow":"hidden"});$("#"+fieldID+" .x-boundlist-outer-ct").jScrollPane();},createList:function(b){var a=this;return Ext.create("Ext.ux.form.MultiSelect",{submitValue:false,flex:1,title:b,store:{model:a.store.model,data:[]},displayField:a.displayField,disabled:a.disabled,listeners:{boundList:{scope:a,itemdblclick:a.onItemDblClick,drop:a.syncValue}}});
},setupItems:function(){var a=this;a.fromField=a.createList(a.fromTitle);a.toField=a.createList(a.toTitle);return{border:false,layout:{type:"hbox",align:"stretch"},items:[a.fromField,{xtype:"container",margins:"0 4",width:24,layout:{type:"vbox",pack:"center"},items:a.createButtons()},a.toField]};},createButtons:function(){var b=this,a=[];
if(!b.hideNavIcons){Ext.Array.forEach(b.buttons,function(c){a.push({xtype:"button",listeners:{"afterrender":function(){Ext.create("Ext.tip.ToolTip",{target:this.id,anchor:"top",cls:"yellowTip",trackMouse:true,html:b.buttonsText[c]});}},handler:b["on"+Ext.String.capitalize(c)+"BtnClick"],cls:Ext.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext.baseCSSPrefix+"form-itemselector-"+c,navBtn:true,width:16,height:16,padding:0,scope:b,margin:"6 4 0 4"});
});}return a;},getSelections:function(b){var a=b.getStore();return Ext.Array.sort(b.getSelectionModel().getSelection(),function(d,c){d=a.indexOf(d);c=a.indexOf(c);if(d<c){return -1;}else{if(d>c){return 1;}}return 0;});},onTopBtnClick:function(){var b=this.toField.boundList,d=b.getStore(),c=this.getSelections(b);
d.suspendEvents();d.remove(c,true);d.insert(0,c);d.resumeEvents();b.refresh();this.syncValue();b.getSelectionModel().select(c);var a=this.fromField.boundList,f=a.getStore(),e=this.getSelections(a);f.suspendEvents();f.remove(e,true);f.insert(0,e);f.resumeEvents();a.refresh();this.syncValue();a.getSelectionModel().select(e);
},onBottomBtnClick:function(){var b=this.toField.boundList,d=b.getStore(),c=this.getSelections(b);d.suspendEvents();d.remove(c,true);d.add(c);d.resumeEvents();b.refresh();this.syncValue();b.getSelectionModel().select(c);var a=this.fromField.boundList,f=a.getStore(),e=this.getSelections(a);f.suspendEvents();
f.remove(e,true);f.add(e);f.resumeEvents();a.refresh();this.syncValue();a.getSelectionModel().select(e);},onUpBtnClick:function(){var g=this.toField.boundList,h=g.getStore(),k=this.getSelections(g),c,d=0,f=k.length,e=0;h.suspendEvents();for(;d<f;++d,e++){c=k[d];e=Math.max(e,h.indexOf(c)-1);h.remove(c,true);
h.insert(e,c);}h.resumeEvents();g.refresh();this.syncValue();g.getSelectionModel().select(k);var a=this.fromField.boundList,b=a.getStore(),j=this.getSelections(a),c,d=0,f=j.length,e=0;b.suspendEvents();for(;d<f;++d,e++){c=j[d];e=Math.max(e,b.indexOf(c)-1);b.remove(c,true);b.insert(e,c);}b.resumeEvents();
a.refresh();this.syncValue();a.getSelectionModel().select(j);},onDownBtnClick:function(){var f=this.toField.boundList,g=f.getStore(),j=this.getSelections(f),c,d=j.length-1,e=g.getCount()-1;g.suspendEvents();for(;d>-1;--d,e--){c=j[d];e=Math.min(e,g.indexOf(c)+1);g.remove(c,true);g.insert(e,c);}g.resumeEvents();
f.refresh();this.syncValue();f.getSelectionModel().select(j);var a=this.fromField.boundList,b=a.getStore(),h=this.getSelections(a),c,d=h.length-1,e=b.getCount()-1;b.suspendEvents();for(;d>-1;--d,e--){c=h[d];e=Math.min(e,b.indexOf(c)+1);b.remove(c,true);b.insert(e,c);}b.resumeEvents();a.refresh();this.syncValue();
a.getSelectionModel().select(h);},onAddBtnClick:function(){var b=this,a=b.getSelections(b.fromField.boundList);b.moveRec(true,a);b.toField.boundList.getSelectionModel().select(a);},onRemoveBtnClick:function(){var b=this,a=b.getSelections(b.toField.boundList);b.moveRec(false,a);b.fromField.boundList.getSelectionModel().select(a);
},moveRec:function(f,e){var c=this,g=c.fromField,a=c.toField,b=f?g.store:a.store,d=f?a.store:g.store;b.suspendEvents();d.suspendEvents();b.remove(e);d.add(e);b.resumeEvents();d.resumeEvents();g.boundList.refresh();a.boundList.refresh();c.syncValue();},syncValue:function(){var a=this;a.mixins.field.setValue.call(a,a.setupValue(a.toField.store.getRange()));
},onItemDblClick:function(a,b){this.moveRec(a===this.fromField.boundList,b);},setValue:function(f){var d=this,g=d.fromField,a=d.toField,b=g.store,e=a.store,c;if(!d.fromStorePopulated){d.fromField.store.on({load:Ext.Function.bind(d.setValue,d,[f]),single:true});return;}f=d.setupValue(f);d.mixins.field.setValue.call(d,f);
c=d.getRecordsForValue(f);b.suspendEvents();e.suspendEvents();b.removeAll();e.removeAll();d.populateFromStore(d.store);Ext.Array.forEach(c,function(h){if(b.indexOf(h)>-1){b.remove(h);}e.add(h);});b.resumeEvents();e.resumeEvents();Ext.suspendLayouts();g.boundList.refresh();a.boundList.refresh();Ext.resumeLayouts(true);
},onBindStore:function(a,b){var c=this;if(c.fromField){c.fromField.store.removeAll();c.toField.store.removeAll();if(a.getCount()){c.populateFromStore(a);}else{c.store.on("load",c.populateFromStore,c);}}},populateFromStore:function(a){var b=this.fromField.store;this.fromStorePopulated=true;b.add(a.getRange());
b.fireEvent("load",b);},onEnable:function(){var a=this;a.callParent();a.fromField.enable();a.toField.enable();Ext.Array.forEach(a.query("[navBtn]"),function(b){b.enable();});},onDisable:function(){var a=this;a.callParent();a.fromField.disable();a.toField.disable();Ext.Array.forEach(a.query("[navBtn]"),function(b){b.disable();
});},onDestroy:function(){this.bindStore(null);this.callParent();}});