Ext.define("Ext.ux.GMapPanel",{extend:"Ext.panel.Panel",alias:"widget.gmappanel",requires:["Ext.window.MessageBox"],initComponent:function(){Ext.applyIf(this,{plain:true,gmapType:"map",border:false});this.callParent();},afterFirstLayout:function(){var a=this.center;this.callParent();if(a){if(a.geoCodeAddr){this.lookupCode(a.geoCodeAddr,a.marker);
}else{this.createMap(a);}}else{Ext.Error.raise("center is required");}},createMap:function(a,b){options=Ext.apply({},this.mapOptions);options=Ext.applyIf(options,{zoom:14,center:a,mapTypeId:google.maps.MapTypeId.HYBRID});this.gmap=new google.maps.Map(this.body.dom,options);if(b){this.addMarker(Ext.applyIf(b,{position:a}));
}Ext.each(this.markers,this.addMarker,this);},addMarker:function(a){a=Ext.apply({map:this.gmap},a);if(!a.position){a.position=new google.maps.LatLng(a.lat,a.lng);}var c=new google.maps.Marker(a);var b=new google.maps.InfoWindow();google.maps.event.addListener(c,"click",function(){openInfoWindow(b,c.map,c);
});return c;},lookupCode:function(b,a){this.geocoder=new google.maps.Geocoder();this.geocoder.geocode({address:b},Ext.Function.bind(this.onLookupComplete,this,[a],true));},onLookupComplete:function(c,b,a){if(b!="OK"){Ext.MessageBox.alert("Error",'An error occured: "'+b+'"');return;}this.createMap(c[0].geometry.location,a);
},afterComponentLayout:function(a,b){this.callParent(arguments);this.redraw();},redraw:function(){var a=this.gmap;if(a){google.maps.event.trigger(a,"resize");}}});